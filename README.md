# 图像拼接与拆分工具

基于 PyQt6 和 Pillow 开发的 Windows 桌面应用，支持无损拼接和原样拆分图片。

## 功能特性

### 拼接模式
- ✅ 支持任意数量图片拖放导入（≥2张）
- ✅ 自动布局：2张1×2，3-4张2×2，5-6张2×3
- ✅ 分批处理：超过6张自动分批，每批最多6张
- ✅ 坐标对齐：不拉伸原图，以每行最高图片和每列最宽图片为准
- ✅ 保持DPI：保存原始图片的分辨率（如300 DPI）
- ✅ 无损导出：JPG格式，quality=100，subsampling=0
- ✅ 元数据保存：自动生成JSON文件记录每张图的坐标、尺寸和DPI
- ✅ 记忆路径：记住上次保存的位置
- ✅ 文件列表：显示所有已选图片的文件名
- ✅ 自动打开：处理完成后可选择打开输出文件夹

### 拆分模式
- ✅ 支持批量导入多个拼接图
- ✅ 自动匹配JSON文件：只需拖放JPG图片，自动查找同目录的JSON
- ✅ 基于坐标信息精确切割
- ✅ 恢复原始DPI：拆分后图片保持原始分辨率
- ✅ 自动恢复原始文件名保存
- ✅ 像素与拼接前完全一致
- ✅ 批量处理：同时处理多个拼接图
- ✅ 记忆路径：记住上次输出目录
- ✅ 自动打开：处理完成后可选择打开输出文件夹

### 通用特性
- ✅ 深色模式：现代化UI设计
- ✅ 拖放支持：方便快捷的文件导入
- ✅ 多线程处理：使用QThread防止界面卡顿
- ✅ 进度显示：实时显示处理进度和批次信息
- ✅ 文件格式支持：JPG、PNG、BMP、WebP、HEIC、HEIF
- ✅ 自定义图标：支持自定义软件图标
- ✅ 跨平台：支持Windows、macOS、Linux

## 安装

```bash
pip install -r requirements.txt
```

## 运行

```bash
python main.py
```

## 打包成EXE

### 方法一：使用打包脚本（推荐）

```bash
python build_exe.py
```

打包后的EXE文件位于 `dist/ImageStitcher.exe`，可直接分发使用。

### 方法二：手动打包

```bash
pip install pyinstaller
pyinstaller --onefile --windowed --name ImageStitcher main.py
```

### 自定义图标

1. 将图标文件命名为 `app_icon.ico` 或 `app_icon.png`
2. 放到项目根目录
3. 重新运行打包脚本

详细说明请参考 [ICON.md](ICON.md)

## 使用说明

### 拼接图片
1. 切换到"图片拼接"标签页
2. 拖放2张或更多图片到拖放区域（支持多选）
3. 查看文件列表确认图片顺序
4. 点击"开始拼接"按钮
5. 选择保存位置（会记住上次位置）
6. 等待处理完成
7. 点击"是"打开输出文件夹查看结果

**布局规则**：
- 2张图片：1×2布局
- 3-4张图片：2×2布局
- 5-6张图片：2×3布局
- 超过6张：自动分批处理，每批最多6张

**输出文件**：
- 单批：生成 `combined.jpg` 和 `combined.json`
- 多批：生成 `combined_part1.jpg/json`、`combined_part2.jpg/json` 等

### 拆分图片
1. 切换到"图片拆分"标签页
2. 拖放一个或多个拼接后的JPG图片（支持多选）
3. 程序自动查找对应的JSON文件
4. 可选：点击"选择输出目录"指定输出位置（会记住上次选择）
5. 点击"开始拆分"按钮
6. 等待处理完成
7. 点击"是"打开输出文件夹查看结果

**提示**：
- JSON文件必须与JPG文件在同一目录
- JSON文件名必须与JPG文件名相同（扩展名不同）
- 支持批量处理多个拼接图

## 技术特点

- **深色模式**：现代化UI设计，护眼舒适
- **拖放支持**：方便快捷的文件导入，支持多选
- **多线程处理**：使用QThread防止界面卡顿，支持大批量处理
- **进度显示**：实时显示处理进度和批次信息
- **无损处理**：最高质量保存选项，保持原始DPI
- **记忆功能**：自动记住上次打开和保存的位置
- **跨平台**：支持Windows、macOS、Linux系统
- **HEIC支持**：支持iPhone拍摄的HEIC格式图片

## 项目结构

```
pintu/
├── main.py                    # 主程序
├── requirements.txt           # 依赖包列表
├── build_exe.py              # 打包脚本
├── create_icon_placeholder.py # 图标生成脚本
├── README.md                 # 使用说明
├── PACKAGE.md               # 打包说明
├── ICON.md                  # 图标说明
├── app_icon.ico             # 软件图标（可选）
└── dist/                    # 打包输出目录
    └── ImageStitcher.exe    # 可执行文件
```

## 常见问题

### 1. 打包后的EXE文件杀毒软件误报
这是PyInstaller打包的正常现象，可以添加到信任白名单。

### 2. 首次运行EXE文件较慢
首次运行需要解压文件到临时目录，属于正常现象。

### 3. 拆分后图片分辨率变成72
确保使用最新版本，程序已经支持保持原始DPI（如300 DPI）。

### 4. 如何处理超过9张图片
程序已更新为每批最多6张，超过6张会自动分批处理。

## 更新日志

### v1.3.0
- ✅ 拼接和拆分时保持原始图片DPI
- ✅ 处理完成后可选择打开输出文件夹
- ✅ 支持自定义软件图标
- ✅ 每批处理改为6张图片（原9张）
- ✅ 修复IFDRational类型序列化问题

### v1.2.0
- ✅ 支持超过9张图片自动分批处理
- ✅ 记忆上次打开和保存的位置
- ✅ 拆分时自动匹配JSON文件
- ✅ 支持批量拆分多个拼接图

### v1.1.0
- ✅ 支持HEIC/HEIF格式
- ✅ 增大图片尺寸限制
- ✅ 显示文件名列表

### v1.0.0
- ✅ 基础拼接和拆分功能
- ✅ 深色模式界面
- ✅ 拖放支持
- ✅ 多线程处理

## 许可证

本项目为免费软件，可自由使用和分发。

## 贡献

欢迎提出问题和建议！
